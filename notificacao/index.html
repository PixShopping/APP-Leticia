<!DOCTYPE html>
<html lang="pt-BR">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="icon" href="../src/img/icon.png" type="x-icon">
		<link type="stylesheet" src="../style.css">
		<title> Notificação | Letícia </title>

		<style scoped>

            @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;600&family=Ubuntu:wght@400;500;700&display=swap');

			:root {
				/* Cores do aplicativo */
				--one: #002242;
				--two: #144774;
				--tree: #336FA5;
				--four: #4E8BB8;
				--five: #6FADD2;
				--six: #9ECAE3;
                --white: white;
				--gray: #b3abab;
				--font: 'Ubuntu', sans-serif;
				--green: rgb(20, 218, 20);
				--red: rgb(240, 36, 36);
			}

			*  {
				padding: 0px;
				margin: 0px;
				box-sizing: border-box;
				font-family: var(--font);
			}

			*::-webkit-scrollbar {
			    display: none; /* Oculta a barra de rolagem padrão no Chrome e Safari */
			}

			body {
				background: var(--white);
				color: var(--one);
				user-select: none;
				font-family: 'Arial', sans-serif;
				overflow-x: hidden;
            }

            .container {
                width: 100vw;
                height: auto;
                display: flex;
                flex-direction: column;
            }

            .local {
                width: 100%;
                height: 70px;
                color: var(--white);
                background: var(--one);
                display: flex;
                justify-content: space-between;
		        align-items: center;
            	padding: 0px 20px 0px 20px;
                z-index: 100;
                box-shadow: 0px 0px 10px var(--one);
            }

            .local ion-icon {
                font-size: 35px;
                margin: 0px;
            	cursor: pointer;
	        }

            .local ion-icon:hover {
                color: var(--two);
                transition: all .3s ease-in-out;
            }

            .local h1 {
		font-size: 24px;
                font-weight: 700;
		letter-spacing: 0.5px;
                display: flex;
            }

            /* - NAVGATION - */

            .navgation {
                width: 100vw;
                height: 80px;
                border-radius: 20px 20px 0px 0px;
                box-shadow: 0px -5px 10px var(--gray);
                display: flex;
                justify-content: space-around;
                align-items: center;
                position: fixed;
                bottom: 0px;
                z-index: 100;
                background: var(--one);
                color: var(--white);
            }

            .navgation ion-icon {
                font-size: 28px;
                cursor: pointer;
            }

            /* SELECIONADO */

            .selecionado {
                background: var(--white);
                color: var(--one);
                border-radius: 50%;
                padding: 15px;
            }

	    /* Content Perfil */

            .container {
                width: 100vw;
                height: auto;
                padding: 0px 0px 90px 0px;
            }

            /* DIV MENSAGENS */

            .mensagens {
                width: 100%;
                height: auto;
                display: flex;
                flex-direction: column;
                align-items: center;
            	margin: 0px 0px 0px 0px;
                padding: 0px 0px 20px 0px;
	    }

            .mensagens li {
                width: 95%;
                height: auto;
                list-style: none;
                background: var(--one);
                border-radius: 10px;
                margin: 25px 0px 0px 0px;
                padding: 20px;
                color: var(--white);
            }

            .mensagens li h1 {
                display: flex;
                width: 100%;
                font-size: 20px;
                font-weight: 500;
                text-transform: capitalize;
            }

            .mensagens li h3 {
                margin: 10px 0px 0px 0px;
                text-transform: capitalize;
                display: flex;
                justify-content: space-between;
                width: 100%;
            }

            .mensagens li h3 .data {
                font-size: 18px;
                font-weight: 500;
                margin: 0px 2px 0px 0px;
            }

            .mensagens li p {
                font-size: 15px;
                font-weight: 500;
                letter-spacing: 0px;
                width: 100%;
                margin: 8px 0px 5px 0px;
                color: #999;
            }

            .mensagens li div {
                width: 100%;
                height: auto;
                display: flex;
                flex-direction: row-reverse;
                align-items: center;
                justify-content: space-between;
                margin: 10px 0px -5px 0px;
                padding: 1px 0px;
            }

            .mensagens li div ion-icon {
                margin: 0px;
                color: white;
                background: var(--red);
                font-size: 30px;
                padding: 5px;
                border-radius: 10px;
                cursor: pointer;
            } 

            .mensagens li div ion-icon#view {
                margin: 0px;
                color: var(--red);
                background: transparent;
                font-size: 42px;
                border-radius: 10px;
                cursor: pointer;
            }

            .mensagens li div a {
                font-size: 18px;
                font-weight: 500;
            }

            .mensagens button {
                width: 135px;
                height: 37px;
                background: var(--two);
                color: white;
                border: none;
                border-radius: 10px;
                font-size: 16px;
                font-weight: 500;
                margin: 0px;
                cursor: pointer;
                display: flex;
                justify-content: center;
                align-items: center;
            } .mensagens button:hover {
                background: var(--white);
                color: var(--one);
                box-shadow: 0px 5px 15px var(--white);
                transition: all .4s ease-in-out;
            }

		    .erro {
			width: 100vw;
			height: auto;
			display: flex;
			flex-direction: column;
			align-items: center;
		    }

		    .erro ion-icon {
			background: var(--six);
			font-size: 100px;
			padding: 50px;
			color: #002242;
			border-radius: 50%;
			margin: 20px 0px 20px 0px;
		    }

		     .erro h1 {
			font-size: 26px;
			font-weight: 700;
			letter-spacing: 0.3px;
			margin: 0px 0px 5px 0px;
		        width: 90%;
			text-align: center;
		     }

		     .erro p {
			font-size: 17px;
			font-weight: 400;
			margin: 0px 0px 5px 0px;
			text-align: center;
			width: 80%;
		     }

             /* Formulario de Mensagem */

        .form-mensagem {
            width: 100vw;
            height: 110vh;
            padding: 20px;
            background: var(--white);
            display: none;
            flex-direction: column;
            z-index: 100;
            position: absolute;
            top: 101vh;
            left: 0px;
            transition: all .4s ease-in-out;
            border-radius: 0px 0px 10px 10px;
            box-shadow: 0 0 10px #232323;
        }

        .form-mensagem div {
            width: 100%;
            display: flex;
            align-items: center;
            margin: 0px 0px 25px 0px;
            padding: 0px 20px 0px 0px;
        }

        .form-mensagem ion-icon {
            font-size: 25px;
            padding: 10px;
            background: var(--one);
            color: var(--white);
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid var(--one);
        } .form-mensagem ion-icon:hover {
            background: var(--white);
            color: var(--one);
            transition: all .4s ease-in-out;
        }

        .form-mensagem h1 {
            font-size: 25px;
            font-weight: 400;
            text-align: center;
            margin: 0px auto;
        }

        .form-mensagem h2 {
            font-size: 21px;
            font-weight: 700;
            letter-spacing: 0.5px;
            margin: 10px 0px;
            color: var(--one);
        }

        .form-mensagem label {
            font-size: 20px;
            font-weight: 400;
            letter-spacing: 0.2px;
            margin: 0px 0px 2px 2px;
        }

        .form-mensagem input {
            width: 100%;
            height: 35px;
            border-radius: 5px;
            background: var(--white);
            color: var(--one);
            border: 1.5px solid var(--one);
            outline: none;
            padding: 10px;
            margin: 0px 0px 12.5px 0px;
        }

        .form-mensagem select {
            width: 100%;
            height: 35px;
            border-radius: 5px;
            background: var(--white);
            color: var(--one);
            border: 1.5px solid var(--one);
            outline: none;
            padding: 0px 10px;
            margin: 0px 0px 12.5px 0px;
        }

        .form-mensagem textarea {
            width: 100%;
            height: 70px;
            border-radius: 5px;
            background: var(--white);
            color: var(--one);
            border: 1.5px solid var(--one);
            outline: none;
            padding:  5px 10px;
            margin: 0px 0px 10px 0px;
        }

        .form-mensagem button {
            width: 90%;
            height: 45px;
            border-radius: 10px;
            background: var(--one);
            color: var(--white);
            margin: 30px auto 10px auto;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            outline: none;
            border: 2px solid var(--one);
        } .form-mensagem button:hover {
            background: var(--white);
            border: 2px solid var(--one);
            color: var(--one);
            box-shadow: 0px 5px 15px  var(--one);
            transition: all .3s ease-in-out;
        }

        /* ALERTA MODIFICADO */
        .swal-modal {
            background-color: var(--one);
            border: 3px solid white;
            border-radius: 10px;
        }

        .swal-title {
            width: 100%;
            height: 40px;
            font-size: 18px;
            color: var(--white);
            border-bottom: 2px solid var(--white);
            padding: 0px 0px 20px 0px;
        }

        .swal-text {
            color: var(--white);
            margin: 20px 0px 0px 0px;
            font-size: 20px;
        }

        .swal-button {
            background-color: var(--white);
            color: var(--one);
        } .swal-button--confirm {
            background-color: var(--white);
            color: var(--one);
        } .swal-button--cancel {
            background-color: var(--red);
            color: white;
        }



            </style>
           </head>

           <body>

            <main class="container">

                <header class="local">

                    <h1>Notificação</h1>
                    <ion-icon onclick="configuracao()" name="settings"></ion-icon>

                </header>

                <div class="mensagens">



                </div>

		<section class="erro">

			<ion-icon name="notifications-outline"></ion-icon>
			<h1>Nenhuma notificação encontrada</h1>
			<p>Volte novamente mais tarde...</p>

		</section>

            </main>

            <section class="form-mensagem">

                <div>
                    <ion-icon onclick="voltar()" name="arrow-back"></ion-icon>
                    <h1>Enviar Mensagem</h1>
                </div>

                <label>Respondendo a Mensagem:</label>
                <h2 id="respondendo"></h2>

                <label>Para:</label>
                <select type="text" id="inputDestinatario">
                    <option value="COORDENACAO">Coordenação</option>
                    <option value="DIRECAO">Direção</option>
                </select>

                <label>Data</label>
                <input type="date" id="inputData">

                <label>Mensagem</label>
                <textarea id="inputMensagem"></textarea>

                <button onclick="enviarResposta()">Enviar Resposta</button>

            </section>

            <nav class="navgation">

                <!-- HOME -->
                <ion-icon onclick="home()" id="home"  name="home"></ion-icon>

                <!-- NOTIFICATION -->
                <ion-icon class="selecionado" onclick="notificacao()" name="notifications"></ion-icon>

                <!-- MENSAGEM -->
                <ion-icon onclick="enviar()" name="mail"></ion-icon>

                <!-- CALL -->
                <ion-icon onclick="suporte()" id="call" name="call"></ion-icon>
                <ion-icon style="display: none;" id="informacao" onclick="projeto()" name="newspaper-outline"></ion-icon>

                <!-- PERFIL -->
                <ion-icon onclick="perfil()" name="person"></ion-icon>

            </nav>

        </body>

       <!-- JavaScript -->
       <script>

        // TEMA ARRUMADO
        const tema = localStorage.getItem('tema');
        const root = document.documentElement;
        if (tema === "light") {
          root.style.setProperty('--one', '#002242');
          root.style.setProperty('--white', 'white');
        } else if (tema === "dark") {
          root.style.setProperty('--one', 'white');
          root.style.setProperty('--white', '#002242');
        }

       // Verificar LOGIN
       const logado = localStorage.getItem('logado');
		if (!logado){
		  window.location.href = "../login.html";
		}

       // HREF / FUNCOES
       function perfil() {
        window.location.href = "../perfil.html";
       }

       function home() {
        window.location.href = "../home.html";
       }

       function notificacao() {
        window.location.href = "../notificacao.html";
       }

       function enviar() {
         window.location.href = "../mensagens.html";
       }

       function configuracao() {
        window.location.href = "../configuracao.html"
       }

       // Verifica se é um professor
       const informacao = document.getElementById('informacao');
        const call = document.getElementById('call');
        if (logado === "PROFESSOR") {
            informacao.style.display = "flex";
            call.style.display = "none";
        } else if (logado === "DIRECAO" || logado === "COORDENACAO") {
            informacao.style.display = "flex";
            call.style.display = "none";
        }

        function projeto() {
        window.location.href = "../projeto.html";
       }

       function suporte() {
		 window.location.href = "tel:1633242256";
		}

       </script>





       <!-- LINKS DO BANCO DE DADOS -->
       <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-app-compat.js"></script>
       <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore-compat.js"></script>
       <!--<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-messaging.js"></script>
       <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-analytics.js"></script>-->

       <!------------------------------->
       <!-- BANCO DE DADOS (FIREBASE) -->
       <!------------------------------->

       <script>

        const firebaseConfig = {
            apiKey: "AIzaSyDycp-UivNqvo5h5PdjYwL0UyCzCvKGgNw",
            authDomain: "banco-de-dados-leticia.firebaseapp.com",
            projectId: "banco-de-dados-leticia",
            storageBucket: "banco-de-dados-leticia.appspot.com",
            messagingSenderId: "230701596733",
            appId: "1:230701596733:web:4c52051fd1e7290e282a54"
          };

	  firebase.initializeApp(firebaseConfig);
	  const db = firebase.firestore();

      function voltar() {
        window.location.reload();
      }

      // Pegar o ANO LETICO ATUAL
      const dataAtual = new Date();
      const anoAtual = dataAtual.getFullYear();
      localStorage.setItem('ano', anoAtual);
      const ANO = localStorage.getItem('ano');

      // ---------------
	  //  LER MENSAGENS
	  // ---------------

      // LENDO MENSAGEM SENDO RESPONSAVEL
      var existe = 0;
      var index = 0;
      const RESPONSAVEL = localStorage.getItem('responsavel');
      const div = document.querySelector('.mensagens');
      const diverro = document.querySelector('.erro');
      if (logado === "RESPONSAVEL") {
        db.collection(ANO)
        .doc("mensagens")
        .collection(RESPONSAVEL)
        .onSnapshot((data) => {
            div.innerHTML = '';
            data.docs.map((val) => {
                const date = val.data().data;
                const dia = date.substring(8);
                const mes = date.substring(5,7);
                const ano = date.substring(0,4);
                var view = 'var(--red)';
                if (val.data().view) {
                    view = 'var(--green)';
                }
                div.innerHTML += `<li data-id="${val.id}" data-view="${val.data().view}" data-index="${index}" data-responder="${val.data().titulo}">
                    <h1>${val.data().titulo}</h1>
                    <h3>
                        ${val.data().destinatario}
                        <v class="data">${dia}/${mes}/${ano}</v>
                    </h3>
                    <p>${val.data().mensagem}</p>
                    <div>
                        <ion-icon style="color: ${view};" onclick="confirmarView(${index})" id="view" name="checkmark-done-circle-outline"></ion-icon>
                        <button onclick="responderMensagem(${index})">Responder</button>    
                    </div>
                    </li>`;
                index++;
                diverro.style.display = "none";
            });
        }); 

      // LENDO MENSAGEM SENDO DIRECAO OU COORDENACAO
      }
      var index = 0;
      if (logado !== "RESPONSAVEL") {
        db.collection(ANO)
        .doc("respostas")
        .collection(logado)
        .onSnapshot((data) => {
            data.docs.map((val) => {
                const date = val.data().data;
                const dia = date.substring(8);
                const mes = date.substring(5,7);
                const ano = date.substring(0,4);
                div.innerHTML += `<li data-index="${index}" data-id="${val.id}">
                    <h1>Respondendo: ${val.data().titulo}</h1>
                    <h3>${val.data().responsavel}</h3>
                    <p>${val.data().resposta}</p>
                    <div>
                        <ion-icon name="trash-outline" onclick="excluirResposta(${index})"></ion-icon>
                        <a>${dia}/${mes}/${ano}</a>
                    </div>
                    </li>`;
                index++;
                diverro.style.display = "none";
            });
        });
      }

      // EXCLUIR RESPOSTA
      function excluirResposta(uindex) {
        const elemento = document.querySelector(`[data-index="${uindex}"]`);
        const id = elemento.getAttribute('data-id');
        
        swal({
            title: "AVISO",
            text: "Voce deseja excluir mesmo?",
            buttons: {
                cancel: "Cancelar",
                confirm: "Excluir!",
            },
        }).then((response) => {
            if (response) {
                db.collection(ANO)
                .doc("respostas")
                .collection(logado)
                .doc(id).delete();

                setTimeout(() => {
                    swal({
                        title: 'AVISO',
                        text: 'Mensagem excluida com sucesso!',
                        buttons: {
                            confirm: "Ok!",
                        },
                    }).then((responsetwo) => {
                        if (responsetwo) {
                            window.location.reload();
                        }
                    });
                }, 1000);
            } else {
                
            }
        })
        
      }

        // Responder Mensagem

        function responderMensagem(uindex) {
            const elemento = document.querySelector(`[data-index="${uindex}"]`)
            const titulo = elemento.getAttribute('data-responder');
            abrirMensagem(titulo);
        }

        function abrirMensagem(titulo) {
            const formMensagem = document.querySelector('.form-mensagem');
            const inputData = document.getElementById('inputData');
            const inputMensagem = document.getElementById('inputMensagem');
            formMensagem.style.display = "flex";
            setTimeout(() => {
                formMensagem.style.top = "0px";
            }, 250);
            document.body.style.overflow = "hidden";

            const respondendo = document.getElementById('respondendo');
            respondendo.innerHTML = titulo;
            localStorage.setItem('titulo', titulo);

            // Pegando a data atual
            const dataAtual = new Date().toISOString().split('T')[0];
            inputData.value = dataAtual;
        }


        function enviarResposta() {
            const inputData = document.getElementById('inputData');
            const inputMensagem = document.getElementById('inputMensagem');
            const inputDestinatario = document.getElementById('inputDestinatario');
            const MENSAGEM = inputMensagem.value;
            const DATA = inputData.value;
            const TITULO = localStorage.getItem('titulo');
            const DESTINATARIO = inputDestinatario.value;
            // Reference the Firestore collection and documents
            db.collection(ANO)
            .doc('respostas')
            .collection(DESTINATARIO)
            .add({
                responsavel: RESPONSAVEL,
                titulo: TITULO,
                resposta: MENSAGEM,
                data: DATA
            });

            swal({
                title: "AVISO",
                text: "Mensagem enviada com sucesso!",
                buttons: {
                    confirm: "Ok!",
                },
            }).then((config) => {
                if (config) {
                    window.location.reload();
                }
            })

            
            
        }

        // CONFIMAR VISUALIZAÇAO

        function confirmarView(index) {
            const elemento = document.querySelector(`[data-index="${index}"]`);
            const id = elemento.getAttribute('data-id');
            const view = elemento.getAttribute('data-view');
            if (view === "true") {
                return;
            } else {
                db.collection(ANO)
                .doc("mensagens")
                .collection(RESPONSAVEL)
                .doc(id).update({
                    view: true
                });
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            }
        }
        

       </script>



    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
	<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

</html>
