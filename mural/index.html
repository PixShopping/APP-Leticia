<!DOCTYPE html>
<html lang="pt-BR">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="icon" href="../src/img/icon.png" type="x-icon">
		<title> Mural | Letícia </title>

		<style scoped>

            @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;600&family=Ubuntu:wght@400;500;700&display=swap');

			:root {
				/* Cores do aplicativo */
				--one: #002242;
				--two: #144774;
				--tree: #336FA5;
				--four: #4E8BB8;
				--five: #6FADD2;
        --six: #9ECAE3;
        --gray: #b3abab;
        --white: white;
        --font: 'Ubuntu', sans-serif;
        --green: rgb(20, 218, 20);
				--red: rgb(240, 36, 36);
			}

			*  {
				padding: 0px;
				margin: 0px;
				box-sizing: border-box;
				font-family: var(--font);
			}

			*::-webkit-scrollbar {
			    display: none; /* Oculta a barra de rolagem padrão no Chrome e Safari */
			}

			body {
				background: var(--white);
				color: var(--one);
				user-select: none;
				font-family: 'Arial', sans-serif;
				overflow-x: hidden;
           	}

            .container {
                width: 100vw;
                height: auto;
                display: flex;
                flex-direction: column;
                padding: 70px 0px 100px 0px;
            }

            .local {
              width: 100%;
              height: 70px;
              color: var(--white);
              background: var(--one);
              display: flex;
              justify-content: space-between;
              align-items: center;
              padding: 0px 20px 0px 20px;
              z-index: 100;
              box-shadow: 0px 5px 15px var(--one);
              position: fixed;
              top: 0px;
            }

            .local ion-icon {
              font-size: 35px;
              margin: 0px;
              cursor: pointer;
            }

            .local ion-icon:hover {
              color: var(--two);
              transition: all .3s ease-in-out;
            }

            .local h1 {
              font-size: 24px;
              font-weight: 700;
              letter-spacing: 0.5px;
              display: flex;
            }


            /* - NAVGATION - */

            .navgation {
                width: 100vw;
                height: 80px;
                border-radius: 20px 20px 0px 0px;
                box-shadow: 0px -5px 10px var(--gray);
                display: flex;
                justify-content: space-around;
                align-items: center;
                position: fixed;
                bottom: 0px;
                z-index: 100;
                background: var(--one);
                color: var(--white);
            }

            .navgation ion-icon {
                font-size: 28px;
                cursor: pointer;
            }

            /* SELECIONADO */

            .selecionado {
                background: var(--white);
                color: var(--one);
                border-radius: 50%;
                padding: 15px;
            }


            /* CONTENT */

            .content {
                width: 100%;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .content h1 {
                font-size: 30px;
                font-weight: 600;
                letter-spacing: 0.2px;
                margin: 25px 0px 15px 0px;
            }

            /* Decorações de provas */

            .decoracaoProvas {
              width: 100%;
              height: 200px;
              display: flex;
              align-items: center;
              justify-content: center;
              background: var(--one);
              color: var(--white);
              padding: 0px 0px 50px 0px;
            }

            .quadro {
                width: 92%;
                height: auto;
                background: var(--white);
                box-shadow: 0px 0px 15px var(--one);
                border-radius: 17.5px;
                margin: -45px 0px 0px 0px;
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 15px 15px 30px 15px;
            }

            .prova {
                width: 92%;
                height: auto;
                background: var(--two);
                color: #ffffff;
                border-radius: 7px;
                margin: 20px 0px 0px 0px;
                display: flex;
                flex-direction: column;
                align-content: center;
                text-align: center;
                padding: 15px;
            }

            .prova .flex {
                display: flex;
                align-items: center;
                width: auto;
                height: auto;
            }

            .prova h1 {
                width: auto;
                height: auto;
                display: flex;
                align-items: center;
                margin: 10px 0px 5px 0px;
                font-size: 22px;
                font-weight: 500;
                color: var(--six);
            }

            .prova p {
                font-size: 20px;
                font-weight: 400;
                margin: 0px 0px 0px 5px;
                color: white;
            }

            /* CARREGANDO */

            .carregando {
                position: relative;
                width: auto;
                height: auto;
                display: flex;
                align-items: center;
                color: var(--one);
                margin: 15px 0px 0px 0px;
            }

                .carregando span {
                    width: 80px;
                    height: 80px;
                    border-radius: 50%;
                    border: 20px solid var(--one);
                    border-top: 21px solid transparent;
                    animation: loading 1.5s linear infinite;
                }

                .carregando h2 {
                    margin: 0px 0px 0px 20px;
                }

                @keyframes loading {
                    0% {
                        transform: rotate(0deg);
                    }
                    100% {
                        transform: rotate(360deg);
                    }
                }

                /* ALERTA MODIFICADO */
                .swal-modal {
                    background-color: var(--one);
                    border: 3px solid white;
                    border-radius: 10px;
                }

                .swal-title {
                    width: 100%;
                    height: 100%;
                    font-size: 22px;
                    color: var(--white);
                    border-bottom: 2px solid var(--white);
                    padding: 0px 0px 20px 0px;
                    letter-spacing: 0.5px;
                }

                .swal-text {
                    color: var(--white);
                    margin: 20px 0px 0px 0px;
                    font-size: 20px;
                    letter-spacing: 0.5px;
                }

                .swal-button {
                    background-color: var(--white);
                    color: var(--one);
                } .swal-button--confirm {
                    background-color: var(--white);
                    color: var(--one);
                } .swal-button--cancel {
                    background-color: var(--red);
                    color: white;
                }

                /* ERRO */

                .erro {
                  display: none;
                  flex-direction: row;
                  align-items: center;
                  width: auto;
                  height: auto;
                  padding: 2.5px;
                  margin: 0px 5px 0px 0px;
                }

                .erro h1 {
                  display: flex;
                  flex-direction: row;
                  align-items: center; 
                  width: auto;
                }

                .erro h1 ion-icon {
                  font-size: 67px;
                  margin: 0px 8px 0px 0px;
                }

                .erro h1 {
                  font-size: 21px;
                  text-align: center;
                }

                /* ENVIAR PROVAS */

                .addProvas {
                  width: 100%;
                  height: auto;
                  flex-direction: column;
                  align-items: center;
                }

                .addProvas h1 {
                  margin: 30px 0px 20px 0px;
                }

                .addProvas .form {
                  width: 90%;
                  max-width: 700px;
                  height: auto;
                  display: flex;
                  flex-direction: column;
                  margin: 10px 0px 40px 0px;
                }

                .addProvas .form label {
                  font-size: 20px;
                  font-weight: 600;
                  letter-spacing: 0.2px;
                  margin: 3px 0px 3px 3px;
                }

                .addProvas .form select {
                  width: 100%;
                  height: 45px;
                  padding: 5px 12px;
                  background: var(--two);
                  color: var(--white);
                  margin: 0px 0px 12px 0px;
                  font-size: 16px;
                  font-weight: 500;
                  border-radius: 10px;
                  outline: none;
                  border: 2px solid var(--two);
                  cursor: pointer;
                }

                .addProvas .form input {
                  width: 100%;
                  height: 45px;
                  padding: 5px 12px;
                  background: var(--two);
                  color: var(--white);
                  margin: 0px 0px 12px 0px;
                  font-size: 16px;
                  font-weight: 500;
                  border-radius: 10px;
                  outline: none;
                  border: 2px solid var(--two);
                  cursor: pointer;
                }

                .addProvas .form button {
                  width: 90%;
                  height: 50px;
                  padding: 10px;
                  background: var(--two);
                  color: var(--white);
                  margin: 15px 0px 5px 0px;
                  font-size: 16.5px;
                  font-weight: 600;
                  letter-spacing: 0.5px;
                  border-radius: 10px;
                  outline: none;
                  border: 2px solid var(--two);
                  cursor: pointer;
                  align-self: center;
                } .addProvas .form button:hover {
                  background: transparent;
                  color: var(--two);
                  transition: all .2s ease-in-out;
                } .addProvas .form button:focus {
                  background: transparent;
                  color: var(--two);
                  transition: all .2s ease-in-out;
                }


                /* TRANSFORMANDO EM CELULAR SE ESTIVER NO PC */
            @media (min-width: 680px) {

            .container {
                margin: 10px auto;
                max-width: 680px;
                min-height: 90vh;
                border: 3.5px solid var(--one);
                border-radius: 20px;
                position: relative;
                padding: 0px 0px 150px 0px;
            }

            .container .before {
                content: '';
                width: 100%;
                height: 50px;
                border-radius: 14px 14px 0px 0px;
                background: var(--one);
                color: var(--white);
                display: flex;
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
            }

            .container .before p {
                font-size: 22px;
                font-weight: 600;
                letter-spacing: 0.3px;
                margin: 0px 0px 0px 20px;
            }

            .container .before .flex {
                width: auto;
                height: auto;
                display: flex;
                margin: 0px 20px 0px 0px;
            }

            .container .before .flex ion-icon {
                font-size: 28px;
                margin: 0px 4px;
            }

            .navgation {
                max-width: 680px;
                left: 50%;
                bottom: 0px;
                border-radius: 18px 18px 0px 0px;
                transform: translateX(-50%);
            }

            .local {
                max-width: 680px;
                margin: 0px;
                position: relative;
            }

            }

            @media (max-width: 679px) {
                .container .before {
                    display: none;
                }
            }


            </style>
           </head>

           <body>

                <main class="container">

                  <div class="before">
                      <p id="hora">00:00:00</p>
                      <div class="flex">
                          <ion-icon name="wifi-outline"></ion-icon>
                          <ion-icon name="cellular-outline"></ion-icon>
                          <ion-icon name="battery-full-outline"></ion-icon>
                      </div>
                  </div>

                  <header class="local">

                    <h1 id="local">Mural</h1>
                    <ion-icon onclick="configuracao()" name="settings"></ion-icon>

                  </header>

                  <!-- PROVAS -->
                  <section class="content provas">
                    
                    <div class="decoracaoProvas">
                      
                      <h1>Avaliações Bimestrais</h1>
                    
                    </div>
                    
                    <article class="quadro">
                        
                      <section class="carregando">
                          <span></span>
                          <h2>Carregando..</h2>
                      </section>

                      <div class="erro">

                        <h1> <ion-icon name="sad-outline"></ion-icon> Nenhuma prova encontrada</h1>

                      </div>

                    </article>

                  </section>

                  <section class="content addProvas">

                    <h1>Adicionar data de prova</h1>

                    <div class="form">

                      <label>Matéria: </label>
                        <select id="inputMateria">

                            <option value="matematica">Matemática</option>
                            <option value="portugues">Português</option>
                            <option value="historia">História</option>
                            <option value="geografia">Geografia</option>
                            <option value="ciencias">Ciências</option>
                            <option value="ingles">Inglês</option>
                            <option value="fisica">Física</option>
                            <option value="quimica">Química</option>
                            <option value="biologia">Biologia</option>
                            <option value="sociologia">Sociologia</option>
                            <option value="filosofia">Filosofia</option>
                            <option value="edfisica">Ed. Fisica</option>
                            <option value="artes">Artes</option>
                            <option value="tecnologia">Tecnologia e Inovação</option>
                            <option value="pv">Projeto de Vida</option>

                        </select>

                        <label>Série: </label>
                        <select id="inputSerie">
                          <option value="" disabled>Serie</option>
                        </select>

                        <label>Data: </label>
                        <input id="inputData" type="date">

                        <label>Cor de Fundo</label>
                        <input id="inputCorFundo" type="color" value="#144774">

                        <label>Cor do Texto</label>
                        <input id="inputCorTexto" type="color" value="#ffffff">

                        <button onclick="enviarProva()">Enviar</button>

                    </div>

                  </section>


                </main>

                <nav class="navgation">

                  <!-- HOME -->
                  <ion-icon onclick="home()" id="home"  name="home"></ion-icon>

                  <!-- NOTIFICATION -->
                  <ion-icon onclick="notificacao()" name="notifications"></ion-icon>

                  <!-- MENSAGEM -->
                  <ion-icon onclick="enviar()" name="mail"></ion-icon>

                  <!-- MURAL -->
                  <ion-icon class="selecionado" onclick="abrirMural()" name="calendar"></ion-icon>

                  <!-- PERFIL -->
                  <ion-icon onclick="perfil()" name="person"></ion-icon>

              </nav>    

            </body>

       <!-- JavaScript -->
       <script>
        
        
        const tema = localStorage.getItem('tema');
        const root = document.documentElement;
        if (tema === "light") {
          root.style.setProperty('--one', '#002242');
          root.style.setProperty('--white', 'white');
        } else if (tema === "dark") {
          root.style.setProperty('--one', 'white');
          root.style.setProperty('--white', '#002242');
        }


       // HREF
       function perfil() {
        window.location.href = "../perfil";
       }

       function home() {
        window.location.href = "../home";
       }

       // Enviar Comunicado
       function enviar() {
         window.location.href = "../mensagens";
       }

       function notificacao() {
        window.location.href = "../notificacao";
       }

        function projeto() {
          window.location.href = "../projeto";
        }

        function configuracao() {
            window.location.href = "../configuracao";
        }

        function abrirMural() {
            window.location.href = "../mural";
        }

        
       </script>


       <!-- LINKS DO BANCO DE DADOS -->
       <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-app-compat.js"></script>
       <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore-compat.js"></script>


       <!------------------------------->
       <!-- BANCO DE DADOS (FIREBASE) -->
       <!------------------------------->

       <script>

        const firebaseConfig = {
            apiKey: "AIzaSyC6aMNEjsgeGK-rw4hzLUximzh1YQ6OEII",
            authDomain: "banco-de-dados-32cac.firebaseapp.com",
            projectId: "banco-de-dados-32cac",
            storageBucket: "banco-de-dados-32cac.appspot.com",
            messagingSenderId: "1001209948956",
            appId: "1:1001209948956:web:e28198053d747377aee8d9"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();


        // Pegar o ANO LETICO ATUAL
        const dataAtual = new Date();
        const anoAtual = dataAtual.getFullYear();
        localStorage.setItem('ano', anoAtual);
        const ANO = localStorage.getItem('ano');

        // PEGANDO AS SERIES DO ANO LETIVO 

        const logado = localStorage.getItem('logado');
          const provas = document.querySelector('.provas');
          const addProvas = document.querySelector('.addProvas');
        
          if (!logado){
            window.location.href = "../login";
          } 
          if (logado === 'RESPONSAVEL') {
            provas.style.display = 'flex';
            addProvas.style.display = 'none';
          } 
          if (logado === 'PROFESSOR') {
            const inputSerie = document.getElementById('inputSerie');
              db.collection(ANO)
              .doc('restrito')
              .collection('series')
              .onSnapshot((data) => {
                data.docs.map((val) => {
                  var serie = val.id;
                  inputSerie.innerHTML += `
                    <option value="${serie}">${serie}</option>
                  `;    
                });
              });
            provas.style.display = 'none';
            addProvas.style.display = 'flex';
          } 
          if (logado === 'DIRECAO' || logado === 'COORDENACAO') {
            provas.style.display = 'none';
            addProvas.style.display = 'none';
          }


          async function enviarProva() {
            const materia = document.getElementById('inputMateria').value;
            const valDate = document.getElementById('inputData').value;
            const corFundo = document.getElementById('inputCorFundo').value;
            const corTexto = document.getElementById('inputCorTexto').value;
            const dia = valDate.slice(8,11);
            const mes = valDate.slice(5,7);
            const ano = valDate.slice(0,4);
            const date = `${dia}/${mes}/${ano}`;
            const serie = document.getElementById('inputSerie').value;
            await db.collection(ANO)
            .doc('provas')
            .collection(serie).add({
                materia: materia,
                data: date,
                corFundo: corFundo,
                corTexto: corTexto
            }).then((response) => {
              swal({
                  title: "AVISO",
                  text: `Prova de ${materia} enviada com sucesso!`,
                  buttons: {
                      confirm: "Ok!",
                  },
              });
              db.collection(ANO)
              .doc('series')
              .collection(serie)
              .onSnapshot((data) => {
                  data.docs.map((val) => {
                    var doc = val.data().responsavel;
                    db.collection(ANO)
                      .doc('responsaveis')
                      .collection(doc)
                      .onSnapshot((data) => {
                          data.docs.map((val) => {
                              var onesignalId = val.data().onesignalId;
                              notificationUserProva(materia, date, onesignalId);
                          });
                      });
                  });
              });
            });
            
          }

        // LER AS PROVAS POSTADAS
        if (logado === 'RESPONSAVEL') {
            const serie = localStorage.getItem('serie');
            const div = document.querySelector('.quadro');
            const erro = document.querySelector('.erro');
            const carregando = document.querySelector('.carregando');
            db.collection(ANO)
            .doc('provas')
            .collection(serie)
            .onSnapshot((data) => {
                if (data.size === 0) {
                  setTimeout(() => {
                    erro.style.display = "flex";
                    carregando.style.display = "none";
                    
                  }, 2000);
                } else {
                  setTimeout(() => {
                    div.innerHTML = '';
                    data.docs.map((val) => {
                        div.innerHTML += `
                            <div style="background: ${val.data().corFundo}; color: ${val.data().corTexto};" class="prova">
                                <h1>Disciplina: <p>${val.data().materia}</p></h1>
                                <h1>Turma: <p>${serie}</p></h1>
                                <h1>Data: <p>${val.data().data}</p></h1>
                            </div>
                        `;
                    });

                  }, 2000);
                }
            });

        }

        function notificationUserProva(materia, data, onesignalId) {

            const notificationData = {
                app_id: '7639757a-a89b-4b52-8028-7e8b9d328e4c', // Substitua pelo ID do seu aplicativo OneSignal
                include_subscription_ids: [onesignalId], // Lista de onesignal_id dos destinatários
                headings: {
                    en: `Prova de ${materia}`,
                    pt: `Prova de ${materia}`,
                },
                contents: {
                    en: data,
                    pt: data,
                },
            };

            fetch('https://onesignal.com/api/v1/notifications', {
                method: 'POST',
                headers: {
                    Authorization: 'Basic MWVkOGFkNDItMjExOC00NTdmLTlkNzUtNmJjNmRhZjljNzg3', // Substitua pelo sua chave da API REST do OneSignal
                    'Content-Type': 'application/json',
                },
                  body: JSON.stringify(notificationData),
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Notificação enviada com sucesso:', data);
                })
                .catch(error => {
                    console.error('Erro ao enviar a notificação:', error);
                });
            
            }

       </script>


      <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
	    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
      <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

       <!-- RELOGIO -->
      <script>

        // RELOGIO 
        function atualizarRelogio() {
            var elementoHora = document.getElementById('hora');
            var agora = new Date();
            
            var horas = agora.getHours();
            var minutos = agora.getMinutes();
            var segundos = agora.getSeconds();

            // Adiciona um zero à esquerda se a hora, minuto ou segundo for menor que 10
            horas = horas < 10 ? '0' + horas : horas;
            minutos = minutos < 10 ? '0' + minutos : minutos;
            segundos = segundos < 10 ? '0' + segundos : segundos;

            // Atualiza o conteúdo do elemento com o ID "hora"
            elementoHora.textContent = horas + ':' + minutos + ':' + segundos;
        }

        // Chama a função inicialmente para exibir o relógio imediatamente
        atualizarRelogio();

        // Atualiza o relógio a cada segundo
        setInterval(atualizarRelogio, 1000);

    </script>

</html>
